<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Carro ElÃ©trico 3D Imersivo | EvoluÃ§Ã£o Veicular</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="carro-3d.css"> <!-- Novo arquivo CSS especÃ­fico -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="immersive-container">
        <!-- Barra superior com logo e botÃ£o de voltar -->
        <div class="top-bar">
            <div class="logo">
                <h1>ðŸš— EvoluÃ§Ã£o Veicular</h1>
            </div>
            <button class="back-button" onclick="window.location.href='index.html'">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
        </div>
        
        <!-- ConteÃºdo principal -->
        <div class="immersive-content">
            <h1 class="immersive-title">Explore um Carro ElÃ©trico Interativo</h1>
            <p class="immersive-subtitle">Interaja com os componentes para descobrir como funciona um veÃ­culo elÃ©trico moderno</p>
            
            <!-- Carro 3D Imersivo (Three.js Viewer) -->
            <div class="car-experience">
                <div class="three-stage">
                    <div id="three-root"></div>
                    <div class="three-overlay">
                        <div class="overlay-title">Tesla 3D</div>
                        <div class="overlay-actions">
                            <button id="reset-view" class="control-btn"><span class="btn-icon">ðŸŽ¯</span> Resetar VisÃ£o</button>
                            <button id="toggle-rotation" class="control-btn"><span class="btn-icon">ðŸŒ€</span> RotaÃ§Ã£o</button>
                        </div>
                        <div class="hud-hint">Toque e arraste para girar. Toque para pausar/retomar.</div>
                    </div>
                    <div class="three-loader" id="three-loader">
                        <div class="spinner"></div>
                        <div>Carregando modelo...</div>
                        </div>
                </div>
            </div>
        </div>
        
        <!-- PartÃ­culas de fundo -->
        <div class="background-particles">
            <div class="particle" style="width: 10px; height: 10px; left: 10%; animation-delay: 0s;"></div>
            <div class="particle" style="width: 15px; height: 15px; left: 20%; animation-delay: 2s;"></div>
            <div class="particle" style="width: 8px; height: 8px; left: 30%; animation-delay: 4s;"></div>
            <div class="particle" style="width: 12px; height: 12px; left: 40%; animation-delay: 6s;"></div>
            <div class="particle" style="width: 7px; height: 7px; left: 50%; animation-delay: 8s;"></div>
            <div class="particle" style="width: 14px; height: 14px; left: 60%; animation-delay: 10s;"></div>
            <div class="particle" style="width: 9px; height: 9px; left: 70%; animation-delay: 12s;"></div>
            <div class="particle" style="width: 11px; height: 11px; left: 80%; animation-delay: 14s;"></div>
            <div class="particle" style="width: 6px; height: 6px; left: 90%; animation-delay: 16s;"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <!-- Import map para resolver mÃ³dulos do Three.js no navegador -->
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
        }
      }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';

        const root = document.getElementById('three-root');
        const loaderEl = document.getElementById('three-loader');
        let renderer, scene, camera, controls, tesla, autoRotate = true;
        let effectRing = null, headLightL = null, headLightR = null, wheelMeshes = [];
        let timers = [];
        const isMobile = window.matchMedia('(max-width: 768px)').matches;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 1.5 : 2));
            renderer.setSize(root.clientWidth, root.clientHeight);
            renderer.outputColorSpace = THREE.SRGBColorSpace;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.0;
            renderer.shadowMap.enabled = !isMobile ? true : false;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            root.appendChild(renderer.domElement);

            camera = new THREE.PerspectiveCamera(50, root.clientWidth / root.clientHeight, 0.1, 100);
            camera.position.set(2.4, 1.2, 3.2);

            const environment = new RoomEnvironment();
            const pmrem = new THREE.PMREMGenerator(renderer);
            const envTex = pmrem.fromScene(environment, 0.04).texture;
            scene.environment = envTex;
            scene.background = null; // mantÃªm fundo do container

            // Luzes
            const hemi = new THREE.HemisphereLight(0xffffff, 0x334155, 0.6);
            scene.add(hemi);

            const dir = new THREE.DirectionalLight(0xffffff, 0.9);
            dir.position.set(3, 5, 4);
            dir.castShadow = true;
            dir.shadow.mapSize.set(2048, 2048);
            scene.add(dir);

            // ChÃ£o suave
            const groundGeo = new THREE.PlaneGeometry(10, 10);
            const groundMat = new THREE.ShadowMaterial({ opacity: 0.25 });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = 0;
            ground.receiveShadow = true;
            scene.add(ground);

            // Efeito de anel sob o carro (quando ligado)
            const ringGeo = new THREE.RingGeometry(0.2, 1.8, 64);
            const ringMat = new THREE.MeshBasicMaterial({ color: 0x2dd4bf, transparent: true, opacity: 0, side: THREE.DoubleSide });
            effectRing = new THREE.Mesh(ringGeo, ringMat);
            effectRing.rotation.x = -Math.PI / 2;
            effectRing.position.y = 0.01;
            scene.add(effectRing);

            // Controles
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.target.set(0, 0.6, 0);
            controls.autoRotate = autoRotate;
            controls.autoRotateSpeed = isMobile ? 0.8 : 1.2;

            // Resize
            window.addEventListener('resize', onResize);

            // UI
            const resetBtn = document.getElementById('reset-view');
            const rotBtn = document.getElementById('toggle-rotation');
            resetBtn?.addEventListener('click', () => {
                controls.reset();
                camera.position.set(2.4, 1.2, 3.2);
            });
            rotBtn?.addEventListener('click', () => {
                autoRotate = !autoRotate;
                controls.autoRotate = autoRotate;
                rotBtn.classList.toggle('active', autoRotate);
            });

            // BotÃµes de experiÃªncia
            document.getElementById('btn-start')?.addEventListener('click', startSystem);
            document.getElementById('btn-charge')?.addEventListener('click', simulateCharging3D);
            document.getElementById('btn-drive')?.addEventListener('click', simulateDriving3D);
            document.getElementById('btn-reset')?.addEventListener('click', resetSystem);

            // Construir Tesla estilizado
            buildTesla();
            const title = document.querySelector('.overlay-title');
            if (title) title.textContent = 'Tesla 3D (Estilizado)';
            loaderEl?.classList.add('hidden');

            // ImersÃ£o mobile: esconde botÃµes e habilita gestos
            if (isMobile) {
                const actions = document.querySelector('.overlay-actions');
                if (actions) actions.style.display = 'none';
                const hint = document.querySelector('.hud-hint');
                if (hint) hint.style.display = 'block';
                autoRotate = true; controls.autoRotate = true; startSystem();

                const canvas = renderer.domElement;
                let pressTimer = null; let pressed = false;
                canvas.addEventListener('touchstart', () => {
                    pressed = true;
                    pressTimer = setTimeout(() => { if (pressed) simulateCharging3D(); }, 650);
                }, { passive: true });
                canvas.addEventListener('touchend', () => {
                    if (pressTimer) clearTimeout(pressTimer);
                    if (pressed) {
                        autoRotate = !autoRotate;
                        controls.autoRotate = autoRotate;
                    }
                    pressed = false;
                });
            }
        }

        function buildTesla() {
            tesla = new THREE.Group();
            // Car paint material
            const bodyMat = new THREE.MeshStandardMaterial({ color: 0xc81e1e, metalness: 0.6, roughness: 0.3, envMapIntensity: 1.0 });
            const glassMat = new THREE.MeshPhysicalMaterial({ color: 0x111111, roughness: 0.05, transmission: 0.0, transparent: true, opacity: 0.75, metalness: 0.0 });
            const blackMat = new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 0.4, roughness: 0.6 });
            const rimMat = new THREE.MeshStandardMaterial({ color: 0xb8c2cc, metalness: 1.0, roughness: 0.2 });

            // Body
            const body = new THREE.Mesh(new RoundedBoxGeometry(2.2, 0.6, 1.2, 8, 0.1), bodyMat);
            body.position.y = 0.7;
            body.castShadow = true; body.receiveShadow = true;
            tesla.add(body);

            // Roof
            const roof = new THREE.Mesh(new RoundedBoxGeometry(1.6, 0.25, 1.15, 8, 0.08), bodyMat);
            roof.position.set(0, 0.95, 0);
            roof.castShadow = true; tesla.add(roof);

            // Windshield
            const windshield = new THREE.Mesh(new THREE.PlaneGeometry(1.2, 0.42), glassMat);
            windshield.position.set(0.35, 0.9, 0.59);
            windshield.rotation.set(-0.1, 0, 0);
            windshield.rotateY(Math.PI);
            tesla.add(windshield);

            // Side windows (left/right)
            const sideWinGeo = new THREE.PlaneGeometry(0.75, 0.35);
            const leftWin = new THREE.Mesh(sideWinGeo, glassMat); leftWin.position.set(-0.2, 0.9, 0.61); tesla.add(leftWin);
            const rightWin = new THREE.Mesh(sideWinGeo, glassMat); rightWin.position.set(-0.2, 0.9, -0.61); rightWin.rotateY(Math.PI); tesla.add(rightWin);

            // Wheels
            function makeWheel(x, z) {
                const wheel = new THREE.Group();
                const tyre = new THREE.Mesh(new THREE.CylinderGeometry(0.28, 0.28, 0.24, 28), blackMat);
                tyre.rotation.z = Math.PI / 2; tyre.castShadow = true; tyre.receiveShadow = true;
                const rim = new THREE.Mesh(new THREE.TorusGeometry(0.18, 0.03, 12, 24), rimMat);
                rim.rotation.y = Math.PI / 2; rim.position.x = 0.01;
                wheel.add(tyre); wheel.add(rim);
                wheel.position.set(x, 0.35, z);
                tesla.add(wheel);
                wheelMeshes.push(wheel);
            }
            makeWheel(0.85, 0.55); // front-right
            makeWheel(-0.85, 0.55); // rear-right
            makeWheel(0.85, -0.55); // front-left
            makeWheel(-0.85, -0.55); // rear-left

            // Charge port indicator
            const chargePort = new THREE.Mesh(new THREE.CircleGeometry(0.06, 16), new THREE.MeshBasicMaterial({ color: 0x00e5ff }));
            chargePort.position.set(-1.05, 0.86, -0.62); tesla.add(chargePort);

            // Headlights (off by default)
            headLightL = new THREE.SpotLight(0x9be7ff, 0, 10, Math.PI/7, 0.6, 1);
            headLightR = new THREE.SpotLight(0x9be7ff, 0, 10, Math.PI/7, 0.6, 1);
            [headLightL, headLightR].forEach(l => { l.castShadow = false; tesla.add(l); tesla.add(l.target); });
            headLightL.position.set(1.15, 0.65, 0.35); headLightL.target.position.set(3, 0.4, 0.35);
            headLightR.position.set(1.15, 0.65, -0.35); headLightR.target.position.set(3, 0.4, -0.35);

            // Position the car
            tesla.position.y = 0;
            scene.add(tesla);
        }

        // ---- ExperiÃªncia: ligar, carregar, conduzir, resetar ----
        function startSystem() {
            // ring fade-in
            if (effectRing) {
                effectRing.material.opacity = 0.0;
                let o = 0;
                const t = setInterval(() => {
                    o += 0.05; effectRing.material.opacity = Math.min(0.6, o);
                    if (o >= 0.6) clearInterval(t);
                }, 30); timers.push(t);
            }
            // headlights on
            if (headLightL && headLightR) { headLightL.intensity = 2.2; headLightR.intensity = 2.2; }
            updatePanelStatus('ðŸš— Sistema Ligado', '#28a745', [
                'âœ… IluminaÃ§Ã£o ativa',
                'âœ… Sistemas prontos',
                'âœ… Pronto para conduÃ§Ã£o'
            ]);
        }

        function simulateCharging3D() {
            updatePanelCharging();
        }

        function simulateDriving3D() {
            // spin wheels and slight sway
            const spinTime = 3000; const start = performance.now();
            const t = setInterval(() => {
                const now = performance.now();
                const p = Math.min(1, (now - start) / spinTime);
                const angle = p * Math.PI * 8;
                if (wheelMeshes.length) wheelMeshes.forEach(w => w.rotation.x = angle);
                if (tesla) tesla.rotation.y = Math.sin(angle/4) * 0.06;
                if (p >= 1) clearInterval(t);
            }, 16); timers.push(t);
            updatePanelStatus('ðŸš— Modo ConduÃ§Ã£o', '#dc3545', [
                'Velocidade: 80 km/h',
                'PotÃªncia: 200 kW',
                'Consumo: 18 kWh/100km'
            ]);
        }

        function resetSystem() {
            timers.forEach(id => clearInterval(id)); timers = [];
            if (tesla) tesla.rotation.set(0,0,0);
            if (wheelMeshes.length) wheelMeshes.forEach(w => w.rotation.x = 0);
        }

        // Painel removido nesta versÃ£o minimalista

        function onResize() {
            const w = root.clientWidth;
            const h = root.clientHeight;
            camera.aspect = w / h;
            camera.updateProjectionMatrix();
            renderer.setSize(w, h);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls?.update();
            renderer?.render(scene, camera);
        }
    </script>
</body>
</html>